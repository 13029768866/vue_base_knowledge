{"version":3,"file":"vue.js","sources":["../../src/array.js","../../src/observer/index.js","../../src/state.js","../../src/init.js","../../src/index.js"],"sourcesContent":["\r\n/* 数组原型 */\r\nlet oldArrayPrototype = Array.prototype;\r\n\r\n/* 基于数组原型创造一个Vue数组原型 */\r\nexport let newArrayPrototype = Object.create(oldArrayPrototype);\r\n\r\nlet methods = [\r\n    'push',\r\n    'pop',\r\n    'shift',\r\n    'unshift',\r\n    'reverse',\r\n    'sort',\r\n    'splice'\r\n];\r\n\r\n/* 7个改变原数组的方法重写 */\r\nmethods.forEach(method => {\r\n  newArrayPrototype[method] = function (...args) {\r\n    const res = oldArrayPrototype[method].apply(this,args);\r\n    let insert;\r\n    let ob = this.__ob__;\r\n\r\n    /* 新增方法判断 */\r\n    switch (method) {\r\n      case 'push':\r\n      case 'unshift':\r\n        insert = args;\r\n        break;\r\n      case 'splice':\r\n        insert = args.slice(2);\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n\r\n    /* 新增的值增加观测 */\r\n    if(insert) ob.observerArray(insert);\r\n\r\n\r\n    return res;\r\n  }\r\n})\r\n\r\n\r\n","import {newArrayPrototype} from \"../array\";\r\n\r\nclass Observer {\r\n  constructor(value){\r\n\r\n    /* 添加是否被观测过的表示‘__ob__’ */\r\n    Object.defineProperty(value,'__ob__',{\r\n      enumerable: false,      // 不可枚举,隐藏属性,不能被循环\r\n      configurable: false,    // 不能被设置\r\n      value: this\r\n    });\r\n\r\n\r\n    /* 数组处理 */\r\n    if(Array.isArray(value)){\r\n      // 函数劫持,切片编程\r\n      value.__proto__ = newArrayPrototype;\r\n      // 观测数组中的对象类型\r\n      this.observerArray(value)\r\n    }else{\r\n      /* 对象处理 */\r\n      this.walk(value)\r\n    }\r\n\r\n  }\r\n  observerArray(data){\r\n    data.forEach(item => {\r\n      observer(item);\r\n    })\r\n  }\r\n  walk(data){\r\n    let keys = Object.keys(data);\r\n    keys.forEach(key => {\r\n      defineReactive(data,key,data[key])\r\n    })\r\n\r\n  }\r\n}\r\nfunction defineReactive(obj,attr,value) {\r\n  /* 递归处理多层级 */\r\n  observer(value);\r\n  Object.defineProperty(obj,attr,{\r\n    get() {\r\n      console.log('用户获取');\r\n      return value;\r\n    },\r\n    set(newValue){\r\n      console.log('用户设置');\r\n      if(newValue === value ) return;\r\n      observer(newValue);\r\n      value = newValue;\r\n    }\r\n  })\r\n}\r\n\r\nexport function observer(data) {\r\n  /* 类型判断 */\r\n  if(typeof data !== 'object' || data === null) return data;\r\n  if(data.__ob__) return data;\r\n  return new Observer(data);\r\n}\r\n","import {observer} from \"./observer/index\";\r\n\r\nexport function initState(vm) {\r\n  const opt = vm.$options;\r\n  /* 1、根据顺序初始化状态 */\r\n  if(opt.props){\r\n    initProps(vm)\r\n  }\r\n  if(opt.methods){\r\n    initMethods(vm)\r\n  }\r\n  if(opt.data){\r\n    initData(vm)\r\n  }\r\n  if(opt.computed){\r\n    initComputed(vm)\r\n  }\r\n  if(opt.watch){\r\n    initWatch(vm)\r\n  }\r\n}\r\n\r\n\r\nfunction initProps(vm) {\r\n\r\n}\r\nfunction initMethods(vm) {\r\n\r\n}\r\nfunction initData(vm) {\r\n  /* 1、类型判断获取data */\r\n  let data = vm.$options.data;\r\n  vm._data = data = typeof data === 'function'?data.call(vm): data;\r\n\r\n  /* 2、进行数据劫持,添加响应式 */\r\n  observer(data);\r\n}\r\nfunction initComputed(vm) {\r\n\r\n}\r\nfunction initWatch(vm) {\r\n\r\n}\r\n","import {initState} from \"./state\";\r\n\r\nexport function initMixin(Vue) {\r\n  Vue.prototype._init = function (options) {\r\n    /* 1、options初始化 */\r\n    let vm = this;\r\n    vm.$options = options;\r\n\r\n\r\n    /* 2、state初始化 */\r\n    initState(vm)\r\n  }\r\n}\r\n","import {initMixin} from \"./init\";\r\n\r\n\r\nfunction Vue(options) {\r\n//  2、执行options初始化\r\n  this._init(options)\r\n}\r\n\r\n// 1、原型上挂载初始化方法\r\ninitMixin(Vue);\r\nexport default Vue;\r\n"],"names":["oldArrayPrototype","Array","prototype","newArrayPrototype","Object","create","methods","forEach","method","args","res","apply","insert","ob","__ob__","slice","observerArray","Observer","value","defineProperty","enumerable","configurable","isArray","__proto__","walk","data","item","observer","keys","key","defineReactive","obj","attr","get","console","log","set","newValue","initState","vm","opt","$options","props","initData","computed","watch","_data","call","initMixin","Vue","_init","options"],"mappings":"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"}